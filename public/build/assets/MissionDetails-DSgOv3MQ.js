import{Q as F,r as i,o as l,d as n,b as D,u as L,w as T,F as b,Z as U,a as e,f as g,t as r,g as y,h as N,x as A,e as w,p as H,q as O,S as h}from"./app-DRiAhqHX.js";import{_ as B}from"./AppLayout-4BVVkt-y.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */const a=m=>(H("data-v-04bdf1d7"),m=m(),O(),m),$={class:"container mx-auto p-6 bg-gray-100 rounded-lg shadow-md"},Q=a(()=>e("h2",{class:"text-3xl font-extrabold text-gray-800 mb-6"},"Détails de la Mission",-1)),W={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},Z=a(()=>e("h3",{class:"text-2xl font-semibold text-gray-700 mb-4"},"Informations de la Mission",-1)),G={class:"text-gray-600 mb-2"},J=a(()=>e("strong",null,"ID:",-1)),K={class:"text-gray-600 mb-2"},X=a(()=>e("strong",null,"Description:",-1)),Y={class:"text-gray-600"},ee=a(()=>e("strong",null,"Adresse:",-1)),te={class:"bg-white p-6 rounded-lg shadow-sm mb-6 overflow-x-auto"},se=a(()=>e("h3",{class:"text-2xl font-semibold text-gray-700 mb-4"},"Climatiseurs",-1)),oe={class:"min-w-full bg-white border border-gray-300"},re=a(()=>e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"py-3 px-4 border-b text-left"},"Marque"),e("th",{class:"py-3 px-4 border-b text-left"},"Puissance"),e("th",{class:"py-3 px-4 border-b text-left"},"Prix Unitaire"),e("th",{class:"py-3 px-4 border-b text-left"},"Quantité"),e("th",{class:"py-3 px-4 border-b text-left"},"Flexible (m)"),e("th",{class:"py-3 px-4 border-b text-left"},"Nbre étage"),e("th",{class:"py-3 px-4 border-b text-left"},"Wifi")])],-1)),ae={class:"py-2 px-4 border-b text-gray-700"},le={class:"py-2 px-4 border-b text-gray-700"},ne={class:"py-2 px-4 border-b text-gray-700"},ie={class:"py-2 px-4 border-b text-gray-700"},de={class:"py-2 px-4 border-b text-gray-700"},ce={class:"py-2 px-4 border-b text-gray-700"},ue={class:"py-2 px-4 border-b text-gray-700"},_e={class:"bg-white p-6 rounded-lg shadow-sm mb-6"},pe=a(()=>e("h3",{class:"text-2xl font-semibold text-gray-700 mb-4"},"Images",-1)),he={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},me=["src","onClick"],be=["href"],ge={key:0,class:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50"},fe={class:"bg-white p-6 rounded-lg shadow-lg max-w-lg w-full"},xe=a(()=>e("h3",{class:"text-xl font-semibold mb-4"},"Télécharger les Photos",-1)),ve=["value"],ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we=["for"],ke=a(()=>e("span",{class:"text-red-500"},"*",-1)),Me={class:"flex items-center gap-2"},qe=["id","name","onChange"],De={key:0,class:"w-16 h-16 border border-gray-300 rounded-lg overflow-hidden"},Pe=["src"],Se=a(()=>e("small",{class:"text-gray-500"},"Taille maximale : 3 Mo",-1)),Ee={key:0,class:"w-full bg-gray-200 rounded-full h-4 mt-4"},Ce={class:"flex justify-end mt-4"},Ie=["disabled"],je={__name:"MissionDetails",setup(m){const{props:f}=F(),c=i(f.mission),P=i(f.climatiseurs),S=i(f.images),x=i(!1),u=i({photo_emplacement_evaporateur:null,photo_numero_serie_evaporateur:null,photo_raccordement_electrique:null,photo_emplacement_condensateur:null,photo_numero_serie_condensateur:null}),k=i(0),_=i(!1),p=i(!0),M=document.querySelector('meta[name="csrf-token"]'),v=M?M.getAttribute("content"):null;v||console.error("Erreur : le jeton CSRF est manquant dans la balise <meta>. Vérifiez que la balise <meta name='csrf-token'> est présente dans votre HTML.");const E=()=>{x.value=!0,p.value=!0},q=()=>{x.value=!1},C=(o,d)=>{const t=o.target.files[0];t&&t.size>3*1024*1024?(h.fire({title:"Erreur",text:"La taille du fichier dépasse 3 Mo. Veuillez sélectionner une image plus petite.",icon:"error"}),o.target.value=""):(u.value[d]=t,I())},I=()=>{p.value=!Object.values(u.value).every(o=>o!==null)},j=o=>o?URL.createObjectURL(o):"",V=async o=>{if(o.preventDefault(),_.value){h.fire({title:"Veuillez patienter",text:"Le chargement des images est en cours. Veuillez patienter jusqu'à la fin.",icon:"info"});return}const d=new FormData;d.append("mission_id",c.value.id),v&&d.append("_token",v);for(let[t,s]of Object.entries(u.value))s&&d.append(t,s);_.value=!0,p.value=!0,k.value=0;try{const t=await fetch("/poseterminer",{method:"POST",body:d});if(t.ok)_.value=!1,h.fire({title:"Upload terminé",text:"Les images ont été téléchargées avec succès",icon:"success"}).then(()=>{window.history.back()}),q();else{const s=await t.json();console.error("Erreur lors du téléchargement des images:",s),h.fire({title:"Erreur",text:"Erreur lors du téléchargement des images",icon:"error"})}}catch(t){console.error("Erreur lors de l'envoi des données:",t),h.fire({title:"Erreur",text:"Erreur lors du téléchargement des images",icon:"error"})}finally{_.value=!1,p.value=!1}};return(o,d)=>(l(),n(b,null,[D(L(U),{title:"Détails de la Mission"}),D(B,{title:"Détails de la Mission"},{default:T(()=>[e("div",$,[Q,e("div",W,[Z,e("p",G,[J,g(" "+r(c.value.id),1)]),e("p",K,[X,g(" "+r(c.value.observations),1)]),e("p",Y,[ee,g(" "+r(c.value.adresse),1)])]),e("div",te,[se,e("table",oe,[re,e("tbody",null,[(l(!0),n(b,null,y(P.value,t=>(l(),n("tr",{key:t.id},[e("td",ae,r(t.marque),1),e("td",le,r(t.puissance),1),e("td",ne,r(t.prix_unitaire),1),e("td",ie,r(t.quantite),1),e("td",de,r(t.flexible),1),e("td",ce,r(t.nbreetage),1),e("td",ue,r(t.wifi),1)]))),128))])])]),e("div",_e,[pe,e("div",he,[(l(!0),n(b,null,y(S.value,t=>(l(),n("div",{key:t.id,class:"relative group"},[e("img",{src:t.image_path,alt:"Image",class:"w-full h-auto rounded-lg transition-transform transform group-hover:scale-105 cursor-pointer",onClick:s=>o.window.location.href=`/image/${t.id}`},null,8,me),e("a",{href:t.image_path,class:"absolute inset-0",target:"blank"},null,8,be)]))),128))])]),e("button",{onClick:E,class:"bg-green-500 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-green-600 transition duration-200"}," Marquer comme terminé ")]),x.value?(l(),n("div",ge,[e("div",fe,[xe,e("form",{onSubmit:N(V,["prevent"])},[e("input",{type:"hidden",name:"mission_id",value:c.value.id},null,8,ve),e("div",ye,[(l(),n(b,null,y({photo_emplacement_evaporateur:"Photo emplacement évaporateur",photo_numero_serie_evaporateur:"Photo numéro de série évaporateur",photo_raccordement_electrique:"Photo raccordement électrique",photo_emplacement_condensateur:"Photo emplacement condensateur",photo_numero_serie_condensateur:"Photo numéro de série condensateur"},(t,s)=>e("div",{key:s,class:"mb-4"},[e("label",{for:s,class:"block text-gray-700 mb-2 text-sm font-semibold"},[g(r(t)+" ",1),ke],8,we),e("div",Me,[e("input",{type:"file",id:s,name:s,required:"",accept:"image/*",onChange:z=>C(z,s),class:"block w-full text-sm text-gray-600 border border-gray-300 rounded p-2"},null,40,qe),u.value[s]?(l(),n("div",De,[e("img",{src:j(u.value[s]),alt:"Preview",class:"w-full h-full object-cover"},null,8,Pe)])):w("",!0)]),Se])),64))]),_.value?(l(),n("div",Ee,[e("div",{style:A({width:k.value+"%"}),class:"bg-blue-500 h-4 rounded-full"},null,4)])):w("",!0),e("div",Ce,[e("button",{type:"submit",disabled:p.value,class:"bg-blue-500 text-white px-4 py-2 rounded-lg text-lg font-semibold hover:bg-blue-600 transition duration-200 disabled:opacity-50"}," Enregistrer ",8,Ie),e("button",{type:"button",onClick:q,class:"bg-red-500 text-white px-4 py-2 rounded-lg text-lg font-semibold hover:bg-red-600 transition duration-200 ml-4"}," Annuler ")])],32)])])):w("",!0)]),_:1})],64))}},Te=R(je,[["__scopeId","data-v-04bdf1d7"]]);export{Te as default};
